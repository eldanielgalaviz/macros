<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-4">
      <h3 class="text-center">Restablecer Contraseña</h3>

      <ng-container *ngIf="!redirecting; else redirectTemplate">
        <form (ngSubmit)="onSubmit(resetForm)" #resetForm="ngForm" class="mt-4">
          <div class="mb-3">
            <label for="new_password" class="form-label">Nueva Contraseña</label>
            <input 
              type="password" 
              class="form-control" 
              id="new_password"
              name="new_password"
              [(ngModel)]="passwords.new_password"
              required
              minlength="6">
          </div>

          <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirmar Contraseña</label>
            <input 
              type="password" 
              class="form-control" 
              id="confirm_password"
              name="confirm_password"
              [(ngModel)]="passwords.confirm_password"
              required>
          </div>

          <div class="alert alert-danger" *ngIf="errorMessage">
            {{ errorMessage }}
          </div>

          <div class="alert alert-success" *ngIf="successMessage">
            {{ successMessage }}
          </div>

          <button 
            type="submit" 
            class="btn btn-primary w-100"
            [disabled]="!resetForm.valid || isLoading">
            {{ isLoading ? 'Actualizando...' : 'Actualizar Contraseña' }}
          </button>
        </form>
      </ng-container>

      <ng-template #redirectTemplate>
        <div class="text-center">
          <div class="alert alert-success">
            <h4 class="alert-heading">¡Contraseña actualizada!</h4>
            <p>{{ successMessage }}</p>
            <hr>
            <p class="mb-0">
              Redirigiendo al login en {{ countdown }} segundos...
            </p>
          </div>
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Redirigiendo...</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>