<div class="navbar text-bg-dark text-white w-100 px-4 py-3">
  <div class="container-fluid">
    <div class="row w-100 align-items-center">
      <div class="col"></div>
      <div class="col text-center">
        <span class="navbar-brand mb-0 h1 text-white">MACROS</span>
      </div>
      <div class="col d-flex justify-content-end align-items-center gap-3">
        <span class="h5 mb-0 text-white">{{ currentUser?.usuario }}</span>
        <button class="btn btn-outline-light" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="card mt-5 mx-auto" style="width: 90%; max-width: 800px; background-color: #ffffff; border: none;">
  <div class="card-body row align-items-center">
    <div class="col text-start">
      <button class="btn" (click)="prev()">
        <i class="fas fa-chevron-left"></i>
      </button>
    </div>
    <div class="col text-center">
      <h5 class="mt-2">{{ selectedDay }}</h5>
    </div>
    <div class="col text-end">
      <button class="btn" (click)="next()">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <!-- Modal de Selección de Alimentos -->
<div class="modal" [class.show]="modalVisible" [style.display]="modalVisible ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Añadir Alimento - Comida {{comidaSeleccionada}}</h5>
        <button type="button" class="btn-close" (click)="cerrarModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Buscador -->
        <div class="mb-3">
          <input 
            type="text" 
            class="form-control" 
            placeholder="Buscar alimento..." 
            [(ngModel)]="busquedaAlimento"
            (input)="filtrarAlimentos()">
        </div>

        <!-- Tabla de Alimentos -->
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Porción</th>
                <th>Cantidad</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let alimento of alimentosFiltrados">
                <td>{{alimento.nombre}}</td>
                <td>{{alimento.porcion}} {{alimento.tipo_porcion}}</td>
                <td style="width: 120px;">
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    [(ngModel)]="cantidades[alimento.id]" 
                    min="0.1" 
                    step="0.1">
                </td>
                <td>
                  <button 
                    class="btn btn-primary btn-sm"
                    [disabled]="!cantidades[alimento.id]"
                    (click)="agregarAlimento(alimento)">
                    Agregar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Mensaje si no hay resultados -->
        <div *ngIf="alimentosFiltrados.length === 0" class="text-center p-3">
          No se encontraron alimentos
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showAlert" 
     class="alert position-fixed top-0 end-0 m-3" 
     [ngClass]="{'alert-success': alertType === 'success', 'alert-danger': alertType === 'error'}"
     style="z-index: 1060;">
  {{ alertMessage }}
</div>
<!-- Overlay para el modal -->
<div class="modal-backdrop fade show" *ngIf="modalVisible"></div>
    
    <!-- Overlay para el modal -->
    <div class="modal-backdrop fade show" *ngIf="modalVisible"></div>
  </div>
</div>

 <!-- Macros Totales -->
<div class="card mt-5 mx-auto" style="width: 90%; max-width: 800px; background-color: #ffffff; border: none;">
  <div class="card-body">
    <h5 class="card-title text-center mb-4">Macronutrientes Totales del Día</h5>

    <div class="px-3"> <!-- Agregado padding horizontal -->
      <!-- Carbohidratos -->
      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0 fw-bold">Carbohidratos</h6>
          <span class="ms-2 fw-bold">{{ macroTotals.carbohidratos_totales.toFixed(1) }}g</span>
        </div>
        <div class="progress" style="height: 25px; background-color: #f0f0f0;">
          <div class="progress-bar bg-info" 
               role="progressbar" 
               [style.width.%]="calculateMacroPercentage(macroTotals.carbohidratos_totales, getTotalMacros())"
               style="font-size: 0.9rem;">
            {{ calculateMacroPercentage(macroTotals.carbohidratos_totales, getTotalMacros()).toFixed(1) }}%
          </div>
        </div>
      </div>

      <!-- Proteínas -->
      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0 fw-bold">Proteínas</h6>
          <span class="ms-2 fw-bold">{{ macroTotals.proteinas_totales.toFixed(1) }}g</span>
        </div>
        <div class="progress" style="height: 25px; background-color: #f0f0f0;">
          <div class="progress-bar bg-success" 
               role="progressbar" 
               [style.width.%]="calculateMacroPercentage(macroTotals.proteinas_totales, getTotalMacros())"
               style="font-size: 0.9rem;">
            {{ calculateMacroPercentage(macroTotals.proteinas_totales, getTotalMacros()).toFixed(1) }}%
          </div>
        </div>
      </div>

      <!-- Grasas -->
      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0 fw-bold">Grasas</h6>
          <span class="ms-2 fw-bold">{{ macroTotals.grasas_totales.toFixed(1) }}g</span>
        </div>
        <div class="progress" style="height: 25px; background-color: #f0f0f0;">
          <div class="progress-bar bg-warning" 
               role="progressbar" 
               [style.width.%]="calculateMacroPercentage(macroTotals.grasas_totales, getTotalMacros())"
               style="font-size: 0.9rem;">
            {{ calculateMacroPercentage(macroTotals.grasas_totales, getTotalMacros()).toFixed(1) }}%
          </div>
        </div>
      </div>

      <!-- Calorías -->
      <div class="mb-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0 fw-bold">Calorías Totales</h6>
          <span class="ms-2 fw-bold">{{ macroTotals.calorias_totales.toFixed(1) }} / {{ userRequerimentoCalorico.toFixed(1) }} kcal</span>
        </div>
        <div class="progress" style="height: 25px; background-color: #f0f0f0;">
          <div class="progress-bar bg-danger" 
               role="progressbar" 
               [style.width.%]="calculateCaloriePercentage()"
               style="font-size: 0.9rem;">
            {{ calculateCaloriePercentage().toFixed(1) }}%
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Secciones de Comidas -->
  <div *ngFor="let numeroComida of [].constructor(cantidadComidas); let i = index" 
       class="card mt-5 mx-auto" 
       style="width: 90%; max-width: 800px; background-color: #ffffff; border: none;">
    <div class="card-body">
      <h5 class="card-title text-center mb-3">{{ getNombreComida(i + 1) }}</h5>
      <hr>

      <!-- Lista de alimentos -->
      <div *ngIf="tieneAlimentos(i + 1)">
        <div *ngFor="let registro of comidas[i + 1]" class="mb-3">
          <div class="row align-items-center">
            <div class="col">
              <strong>{{ registro.alimento }}</strong>
              <div class="small text-muted">
                Cantidad: {{ registro.cantidad }}
                <br>
                P: {{ registro.proteinas.toFixed(1) }}g | 
                C: {{ registro.carbohidratos.toFixed(1) }}g | 
                G: {{ registro.grasas.toFixed(1) }}g | 
                Cal: {{ registro.calorias.toFixed(1) }}kcal
              </div>
            </div>
            <div class="col-auto">
              <button class="btn btn-sm btn-outline-primary me-2" (click)="editarCantidad(registro)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="eliminarAlimento(registro.id)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

        <!-- Totales por comida -->
        <div class="mt-3 pt-3 border-top">
          <div class="row">
            <div class="col-6">
              <small class="text-muted">Proteínas: {{ getMacrosPorComida(i + 1).proteinas_totales.toFixed(1) }}g</small>
            </div>
            <div class="col-6">
              <small class="text-muted">Carbohidratos: {{ getMacrosPorComida(i + 1).carbohidratos_totales.toFixed(1) }}g</small>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-6">
              <small class="text-muted">Grasas: {{ getMacrosPorComida(i + 1).grasas_totales.toFixed(1) }}g</small>
            </div>
            <div class="col-6">
              <small class="text-muted">Calorías: {{ getMacrosPorComida(i + 1).calorias_totales.toFixed(1) }}kcal</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay alimentos -->
      <div *ngIf="!tieneAlimentos(i + 1)" class="text-center text-muted">
        No hay alimentos registrados
      </div>

      <div class="text-center mt-3">
        <button class="btn btn-primary" (click)="abrirModalAlimentos(i + 1)">
          Añadir Alimento
        </button>
      </div>
    </div>

  <!-- Control de Agua -->
  <div class="card mt-5 mb-5 mx-auto" style="width: 90%; max-width: 800px; background-color: #ffffff; border: none;">
    <div class="card-body d-flex flex-column" style="height: 100%;">
      <hr>
      <div class="text-center">
        <h5 class="mt-2">Agua: {{ currentWater }} ml</h5>
      </div>

      <div class="row align-items-center flex-grow-1">
        <div class="col text-start">
          <button class="btn btn-link" (click)="decreaseWater()">
            <img src="assets/imagenes/menos.png" alt="Menos agua" style="width: 50px; height: 50px;">
          </button>
        </div>
        <div class="col text-end">
          <button class="btn btn-link" (click)="increaseWater()">
            <img src="assets/imagenes/mas.png" alt="Más agua" style="width: 50px; height: 50px;">
          </button>
        </div>
      </div>

      <hr>
      <div class="progress">
        <div class="progress-bar bg-info text-dark" 
             role="progressbar" 
             [style.width.%]="getWaterPercentage()">
          {{ currentWater }} ml
        </div>
      </div>
    </div>
  </div>